<div fxLayoutAlign="center center" class="root">
    <div style="margin: auto; width: 800px; min-width: 250px;">
        <div fxLayoutAlign="center" *ngIf="editable">
            <mat-form-field class="title-input" appearance="outline">
                <mat-label>Survey Name</mat-label>
                <input matInput [(ngModel)]="survey.name" placeholder="Type Something...">
            </mat-form-field>
        </div>
        <div *ngIf="!editable">
            <h1 class="large" fxHide.lt-sm>{{survey.name}}</h1>
            <h1 fxHide.gt-xs>{{survey.name}}</h1>
        </div>

        <div fxLayout="row" fxLayoutAlign="center" fxLayoutGap="16px" style="margin-bottom: 32px;">
            <mat-slide-toggle [(ngModel)]="editable" matTooltip="Preview how the survey will look">Edit Survey</mat-slide-toggle>
            <button mat-raised-button color="primary" [disabled]="loadingUnknown || !dirty" (click)="saveSurvey()">Save Survey</button>
            <button mat-raised-button *ngIf="key !== ''"  [routerLink]="'/manage-survey/' + id + '/' + key">Manage Survey</button>
        </div>

        <div *ngIf="!editable">
            <p style="text-align: center;">This is what the people taking your survey will see.</p>
        </div>

        <!-- People Chooser -->
        <div *ngIf="editable">
            <p>Who are these questions for?<mat-icon
                    matTooltip="Names entered here will be insterted into generated question and answers"
                    matTooltipTouchGestures="on" class="help-icon">help</mat-icon>
            </p>
            <mat-form-field class="user-chip-list" appearance="fill">
                <mat-label>People</mat-label>
                <mat-chip-list #chipList aria-label="People selection">
                    <mat-chip *ngFor="let user of survey.users" [selectable]="usersSelectable" [removable]="usersRemovable"
                        (removed)="removeUser(user)">
                        {{user.name}}
                        <mat-icon matChipRemove>cancel</mat-icon>
                    </mat-chip>
                    <input placeholder="New Person..." [matChipInputFor]="chipList"
                        [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="usersAddOnBlur"
                        (matChipInputTokenEnd)="addUser($event)">
                </mat-chip-list>
            </mat-form-field>
        </div>        

        <!-- Questions -->
        <div *ngFor="let question of survey.questions; let i = index" style="margin-bottom: 32px;">
            <app-form-question [question]="question" [loading]="loading[i]" [editable]="editable" [questionNumber]="(i+1).toString()"
                (qDelete)="deleteQuestion(i)" (qRandomize)="getQuestion(i)" (qRandomizeAnswers)="getAnswer(i, -1)"
                (qSeed)="seedQuestion(i)" (qEditText)="editQuestion(i)" (qReset)="getQuestion(i, true)"
                (qShuffle)="getQuestion(i, false, '', true)" (qEditType)="editQuestionType(i, $event)"
                (aAdd)="addAnswer(i)" (aDelete)="deleteAnswer(i, $event)" (aRandomize)="getAnswer(i, $event)"
                (aEditText)="editAnswer(i, $event)" (aOtherOptionAllow)="otherOptionAllow(i)" (aEditScale)="editScaleValues(i)">
            </app-form-question>
        </div>

        <mat-progress-bar *ngIf="loadingUnknown" mode="indeterminate" style="margin-bottom: 16px;"></mat-progress-bar>

        <div *ngIf="editable" fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="center">
            <button mat-raised-button color="primary" [disabled]="loadingUnknown" (click)="getQuestion()"><mat-icon>add</mat-icon> Add Question</button>
            <button mat-raised-button color="accent" [disabled]="loadingUnknown" [mat-menu-trigger-for]="questionType"><mat-icon>view_carousel</mat-icon> From Template</button>
            <mat-menu #questionType="matMenu">
                <button mat-menu-item (click)="addQuestion('text')"><mat-icon>create</mat-icon>Text</button>
                <button mat-menu-item (click)="addQuestion('multi')"><mat-icon>radio_button_checked</mat-icon>Choice</button>
                <button mat-menu-item (click)="addQuestion('check')"><mat-icon>check_box</mat-icon>Check</button>
                <button mat-menu-item (click)="addQuestion('rank')"><mat-icon>stacked_bar_chart</mat-icon>Rank</button>
                <button mat-menu-item (click)="addQuestion('scale')"><mat-icon>star_half</mat-icon>Rate</button>
                <button mat-menu-item (click)="addQuestion('date')"><mat-icon>today</mat-icon>Date</button>
                <button mat-menu-item (click)="addQuestion('time')"><mat-icon>schedule</mat-icon>Time</button>
            </mat-menu>
        </div>

    </div>
</div>