<mat-card>

    <mat-card-subtitle *ngIf="questionNumber === undefined">Question: {{question.seed}}</mat-card-subtitle>
    <mat-card-subtitle *ngIf="questionNumber !== undefined">Question: {{questionNumber}}<span *ngIf="question.seed !== ''">, Seed: {{question.seed}}</span></mat-card-subtitle>


    <mat-card-content>
        <p [innerHTML]="question.text"></p>
        <ng-template [ngTemplateOutlet]="getAnswerTemplate()"></ng-template>
    </mat-card-content>

    <ng-container *ngIf="editable || basicEdit">
        <mat-divider inset style="margin-bottom: 8px;"></mat-divider>

        <mat-card-actions fxLayoutGap="8px" fxLayout="row">
            <button mat-flat-button color="primary" [disabled]="loading" (click)="qRandomize.emit()">
                <mat-icon>casino</mat-icon> Question
            </button>
            <button mat-flat-button color="accent" [disabled]="loading || question.custom" (click)="qRandomizeAnswers.emit()">
                <mat-icon>casino</mat-icon> Answers
            </button>
            <button mat-flat-button color="accent" (click)="qShuffle.emit()" [disabled]="loading || question.custom" fxHide.lt-sm>
                <mat-icon>shuffle</mat-icon>Shuffle Question
            </button>
            <button mat-icon-button [mat-menu-trigger-for]="moreMenu" *ngIf="basicEdit"><mat-icon>more_vert</mat-icon></button>
            <mat-menu #moreMenu="matMenu">
                <button mat-menu-item (click)="qSeed.emit()"><mat-icon>search</mat-icon>Seed</button>
            </mat-menu>

            <div fxFlex></div>
            <button mat-icon-button *ngIf="editable" [disabled]="loading" [matMenuTriggerFor]="edit"><mat-icon>edit</mat-icon></button>
            <mat-menu #edit="matMenu">
                <button mat-menu-item (click)="qEditText.emit()"><mat-icon>edit</mat-icon>Edit Text</button>
                <button mat-menu-item [mat-menu-trigger-for]="questionType"><mat-icon>view_carousel</mat-icon>Answer Type</button>
                <button mat-menu-item (click)="qSeed.emit()"><mat-icon>search</mat-icon>Seed</button>
                <button mat-menu-item (click)="qShuffle.emit()" fxHide.gt-xs [disabled]="question.custom"><mat-icon color="accent">shuffle</mat-icon>Shuffle Question</button>
                <button mat-menu-item (click)="qReset.emit()"><mat-icon color="accent">restart_alt</mat-icon>Reset Question</button>
                <button mat-menu-item (click)="qDelete.emit()"><mat-icon color="warn">delete</mat-icon>Delete Question</button>
            </mat-menu>

            <mat-menu #questionType="matMenu">
                <button mat-menu-item (click)="qEditType.emit('text')" [disabled]="question.answerType==='text'"><mat-icon>create</mat-icon>Text</button>
                <button mat-menu-item (click)="qEditType.emit('multi')" [disabled]="question.answerType==='multi'"><mat-icon>radio_button_checked</mat-icon>Choice</button>
                <button mat-menu-item (click)="qEditType.emit('check')" [disabled]="question.answerType==='check'"><mat-icon>check_box</mat-icon>Check</button>
                <button mat-menu-item (click)="qEditType.emit('rank')" [disabled]="question.answerType==='rank'"><mat-icon>stacked_bar_chart</mat-icon>Rank</button>
                <button mat-menu-item (click)="qEditType.emit('scale')" [disabled]="question.answerType==='scale'"><mat-icon>star_half</mat-icon>Rate</button>
                <button mat-menu-item (click)="qEditType.emit('date')" [disabled]="question.answerType==='date'"><mat-icon>today</mat-icon>Date</button>
                <button mat-menu-item (click)="qEditType.emit('time')" [disabled]="question.answerType==='time'"><mat-icon>schedule</mat-icon>Time</button>
            </mat-menu>

        </mat-card-actions>
    </ng-container>

    <mat-card-footer>
        <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>
    </mat-card-footer>
</mat-card>


<!-- Answer Templates -->
<ng-template #formDefault>
    <p>Unknown Template: {{question.answerType}}</p>
</ng-template>

<ng-template #formText>
    <app-form-text [choices]="question.choices" [editable]="editable"
        (aAdd)="aAdd.emit()" (aDelete)="aDelete.emit($event)" 
        (aEditText)="aEditText.emit($event)" (aRandomize)="aRandomize.emit($event)">
    </app-form-text>
</ng-template>

<ng-template #formMulti>
    <app-form-multi [choices]="question.choices" [editable]="editable"
        [otherOptionAllow]="question.otherOptionAllow" [otherOptionText]="question.otherOptionText"
        (aAdd)="aAdd.emit()" (aDelete)="aDelete.emit($event)" (aOtherOptionAllow)="aOtherOptionAllow.emit()"
        (aEditText)="aEditText.emit($event)" (aRandomize)="aRandomize.emit($event)">
    </app-form-multi>
</ng-template>

<ng-template #formCheck>
    <app-form-check [choices]="question.choices" [editable]="editable"
        (aAdd)="aAdd.emit()" (aDelete)="aDelete.emit($event)" 
        (aEditText)="aEditText.emit($event)" (aRandomize)="aRandomize.emit($event)"></app-form-check>
</ng-template>

<ng-template #formRank>
    <app-form-rank [choices]="question.choices" [editable]="editable"
    (aAdd)="aAdd.emit()" (aDelete)="aDelete.emit($event)" 
    (aEditText)="aEditText.emit($event)" (aRandomize)="aRandomize.emit($event)"></app-form-rank>
</ng-template>

<ng-template #formDate>
    <app-form-date [choices]="question.choices" [editable]="editable"
    (aAdd)="aAdd.emit()" (aDelete)="aDelete.emit($event)" 
    (aEditText)="aEditText.emit($event)" (aRandomize)="aRandomize.emit($event)"></app-form-date>
</ng-template>

<ng-template #formTime>
    <app-form-time [choices]="question.choices" [editable]="editable"
    (aAdd)="aAdd.emit()" (aDelete)="aDelete.emit($event)" 
    (aEditText)="aEditText.emit($event)" (aRandomize)="aRandomize.emit($event)"></app-form-time>
</ng-template>

<ng-template #formScale>
    <app-form-scale [choices]="question.choices" [editable]="editable" [scaleValues]="question.scaleValues"
    (aAdd)="aAdd.emit()" (aDelete)="aDelete.emit($event)" (aEditScale)="aEditScale.emit()"
    (aEditText)="aEditText.emit($event)" (aRandomize)="aRandomize.emit($event)"></app-form-scale>
</ng-template>
